rules_version = '2';
service cloud.firestore {

  match /databases/{database}/documents {
  
  	function isUserMemberOfSBMA() {
  		let uid = request.auth.uid;
      let SBMA = "I8Myn7qqYInyIo8aOiHs";
   		return uid in get(/databases/$(database)/documents/organizations/$(SBMA)).data.members;
  	}
    
    function isUserModeratorOfSBMA() {
  		let uid = request.auth.uid;
      let SBMA = "test123";
   		return uid in get(/databases/$(database)/documents/organizations/$(SBMA)).data.moderators;
  	}
    
    match /requests/{requestId} {
    	allow create: if resource == null; 
      allow read, write: if isUserMemberOfSBMA();
    }
    
    match /donations/{requestId} {
    	allow create: if resource == null; 
      allow read, write: if isUserMemberOfSBMA();
    }
    
    match /threads/{threadId} {
    	allow create: if resource == null; 
      allow read, write: if isUserMemberOfSBMA();
    }
    
    match /organizations/{organizationId} {
    	allow read;
      allow write: if request.auth != null;
    }
    
    match /{document=**} {
    	allow create: if resource == null; 
      allow read, write: if isUserMemberOfSBMA();
    }
    
  }
}

